#
# Project: dp-api-java
# File:    dp-api-tools-config.yml
# Type:    YAML
#
# Configuration parameters for the Java API Library tools.
#
# The tool set included with the Java API Library interface to the Data Platform requires some configuration
# parameters for proper operations.  All configuration parameters for all tools are included here.
#
# Some configuration parameters are available for performance tuning, especially for tools that measure
# Java API Library performance or Data Platform Core Services performance. 
#
# Author: Christopher K. Allen
# Since: May 4, 2025
#
#
# NOTES:
#
# - This parameter set can be modified according to the Data Platform cnofiguration and installations requirements.
# - These parameters are available programmatically within the Java structure class 'DpApiToolsConfig'.
# - The name indexing for the PV within the Data Platform test archive is 1-based, opposed to Java standard 0-basing.
# - The data source (PV) names are formed by appending the PV index (1-based) to the pvPrefix value.
# - The indexes within the query/testArchive YAML block are 0-based Java indexes (they are incremented by 1 to form the PV names)
# - Data sources pvPrefix+pvIndexStartClock through pvPrefix+(pvIndexStartClock+pvCountClock) utilize a uniform sampling clock
# - Data sources pvPrefix+pvIndexStartTmsList through pvPrefix+(pvIndexStartTmsList+pvCountTmsList) utilize explicit timestamp lists
# - Explicit timestamp lists are only available after Data Platform release 1.8 and its accompanying app-run-test-data-generator
#  
#output:
#   query:
#      channel:
#         path: test/output/query/channel   # QueryChannelEvaluator output location : JAL_TOOLS_OUTPUT__QUERY_CHANNEL_PATH
         
query:
   output:
      channel:
         path: query/channel    # QueryChannel evaluation output location : JAL_TOOLS_QUERY_OUTPUT_CHANNEL_PATH
      correl:
        path: query/correl      # Raw data correlation output locatoin    : JAL_TOOLS_QUERY_OUTPUT_CORREL_PATH
         
   logging:      # General Query Service tools logging services configuration
      enabled: true                  # is logging active              : JAL_TOOLS_QUERY_LOGGING_ENABLED
      level: DEBUG                   # logger output level if active  : JAL_TOOLS_QUERY_LOGGING_LEVEL
      
   timeout:      # General query timeout properties (e.g., used for tools test timeouts)
      enabled: true                  # apply timeout condition    : JAL_TOOLS_QUERY_TIMEOUT_ENABLED
      limit: 75                      # request timeout limit      : JAL_TOOLS_QUERY_TIMEOUT_LIMIT
      unit: SECONDS                  # java.concurrent.TimeUnit   : JAL_TOOLS_QUERY_TIMEOUT_UNIT
      
   concurrency:  # General concurrency (multi-threading) properties
      enabled: true                  # use concurrency            : JAL_TOOLS_QUERY_CONCURRENCY_ENABLED
      pivotSize: 10                  # size inducing concurrency  : JAL_TOOLS_QUERY_CONCURRENCY_PIVOT_SIZE
      maxThreads: 20                 # max worker thread count    : JAL_TOOLS_QUERY_CONCURRENCY_MAX_THREADS
      
   testArchive:   # Data Platform test archive properties (generated with utility 'app-run-test-data-generator') 
      firstTimestamp: 2023-10-31T15:51:02.000+00:00 # first timestap w/in archive : JAL_TOOLS_QUERY_ARCHIVE_FIRST_TIMESTAMP     
      lastTimestamp: 2023-10-31T15:52:01.999+00:00  # last timestamp w/in archive : JAL_TOOLS_QUERY_ARCHIVE_LAST_TIMESTAMP
      pvPrefix: "dpTest_"        # the prefix of all data source names         : JAL_TOOLS_QUERY_ARCHIVE_PV_PREFIX
      pvCountTotal: 4000         # total number of data sources (PV names)     : JAL_TOOLS_QUERY_ARCHIVE_PV_COUNT_TOTAL
      pvCountClock: 3800         # number of data sources using sampling clock : JAL_TOOLS_QUERY_ARCHIVE_PV_COUNT_CLOCK
      pvCountTmsList: 200        # number of data source using timestamp list (rel>=1.8) : JAL_TOOLS_QUERY_ARCHIVE_PV_COUNT_TMS_LIST
      pvIndexStartClock: 0       # index of first clocked data source                    : JAL_TOOLS_QUERY_ARCHIVE_PV_INDEX_CLOCK 
      pvIndexStartTmsList: 3800  # index of first timestamp list data source (rel>=1.8)  : JAL_TOOLS_QUERY_ARCHIVE_PV_INDEX_START_TMS_LIST
      
   testRequests:
      testSuites:     # Used by QueryChannelEvaluator
      - testSuite:
          name: "Clocked PVs"   # Test suite name
          requestIds:                 # List<TestArchiveRequest> enumerations
          - CLOCKED_1000PVSx1SEC
          - CLOCKED_1000PVSx5SEC
          requestComposites:          # List<RequestDecompType> enumerations   
          - NONE
          - HORIZONTAL
          streamCounts:               # List<Integer> of composite requests counts
          - 2
          - 3
          streamTypes:                # List<DpGrpcStreamType> enumerations
          - BACKWARD
          - BIDIRECTIONAL
      - testSuite:
          name: "The Big One"   # Test suite name
          requestIds:                 # List<TestArchiveRequest> enumerations
          - GENERAL_4000PVSx20SEC
          requestComposites:          # List<RequestDecompType> enumerations   
          - NONE
          - HORIZONTAL
#          - VERTICAL
          streamCounts:               # List<Integer> of composite requests counts
          - 2
          - 3
          - 4
          streamTypes:                # List<DpGrpcStreamType> enumerations
          - BACKWARD
          - BIDIRECTIONAL
      - testSuite:
          name: "Several Large Queries"   # Test suite name
          requestIds:                 # List<TestArchiveRequest> enumerations
          - CLOCKED_2000PVSx10SEC
          - CLOCKED_2000PVSx20SEC
          - GENERAL_4000PVSx20SEC
          requestComposites:          # List<RequestDecompType> enumerations   
          - NONE
          - HORIZONTAL
          streamCounts:               # List<Integer> of composite requests counts
          - 2
          - 3
          - 4
          streamTypes:                # List<DpGrpcStreamType> enumerations
          - BACKWARD
          - BIDIRECTIONAL
    
   recovery:         # Configuration parameters for time-series data requests and recovery
      request:        # Default parameters used in data requests
         stream:           # gRPC streaming default parameters
            preference: BACKWARD        # {BACKWARD, BIDRECTIONAL} : JAL_TOOLS_RECOVERY_REQUEST_STREAM_PREFERENCE
         decompose:        # data request query decomposition default parameters (for multi-streaming)
            enabled: true           # use query decomposition  : JAL_TOOLS_RECOVERY_REQUEST_COMPOSITE_ENABLED
            maxSources: 1000        # max data source count    : JAL_TOOLS_RECOVERY_REQUEST_COMPOSITE_MAX_SOURCES
            maxDuration: 1          # max time duration (unit) : JAL_TOOLS_RECOVERY_REQUEST_COMPOSITE_MAX_DURATION
            durationUnit: SECONDS   # java.concurrent.TimeUnit : JAL_TOOLS_RECOVERY_REQUEST_COMPOSITE_DURATION_UNIT
      response:       # Default parameters used for data responses
         correlate:        # Query data correlation parameters
            useConcurrency: true    # use mult-thread correlation : JAL_TOOLS_RECOVERY_RESPONSE_CORRELATE_USE_CONCURRENCY
            whileStreaming: true    # correlate during gRPC stream: JAL_TOOLS_RECOVERY_RESPONSE_CORRELATE_WHILE_STREAMING
         multistream:      # Multiple gRPC data stream parameters
            enabled: true            # use multistreamed responses : JAL_TOOLS_RECOVERY_RESPONSE_MULTISTREAM_ENABLED
            maxStreams: 3            # maximum stream count        : JAL_TOOLS_RECOVERY_RESPONSE_MULTISTREAM_MAX_STREAMS
            sizeDomain: 2000         # rqst domain size (samples-time) triggering ms : JAL_TOOLS_RECOVERY_RESPONSE_MULTISTREAM_PIVOT_SIZE
      table:         # Default parameters used for time-series data table construction
         construction:      # General data table reconstruction parameters
            errorChecking: true      # use advanced error checking : JAL_TOOLS_RECOVERY_TABLE_CONSTRUCTION_ERROR_CHECKING
            domainCollision: false   # allow/disallow time domain collision : JAL_TOOLS_RECOVERY_TABLE_CONSTRUCTION_DOMAIN_COLLISION 
         sstatic:           # static data table properties 
            isDefault: true          # use static table as default  : JAL_TOOLS_RECOVERY_TABLE_STATIC_DEFAULT
            hasMaxSize: true         # enforce maximum table size   : JAL_TOOLS_RECOVERY_TABLE_STATIC_HAS_MAX_SIZE
            maxSize: 4000000         # maximum size (bytes) allowed : JAL_TOOLS_RECOVERY_TABLE_STATIC_MAX_SIZE
         dynamic:           # dynamic data table properties
            enable: true             # enable dynamic data tables   : JAL_TOOLS_RECOVERY_TABLE_DYNAMIC_ENABLE
    
   